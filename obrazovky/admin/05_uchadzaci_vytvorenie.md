# Vytvorenie uchádzača (Admin, Gestor, Komisia)

## Kontext
- Uchádzač sa vytvára **v kontexte konkrétneho VK**
- Nie je možné vytvoriť uchádzača "standalone"
- Uchádzač je automaticky priradený k VK, v ktorom bol vytvorený

## Prístup
- **Admin**: môže vytvoriť uchádzača len pre VK vo svojich rezortoch
- **Gestor, Komisia**: môže vytvoriť uchádzača len pre VK, kde je priradený

## Vstupný bod
- Z **detailu VK** → tlačidlo **"+ Pridať uchádzača"**
- Otvorí modal alebo novú stránku

---

## Wireframe - Modal: Pridať uchádzača

```
┌─────────────────────────────────────────────────────────────┐
│                                                               │
│   ┌────────────────────────────────────────────────────┐    │
│   │ Pridať uchádzača do VK-2025-001                    │    │
│   ├────────────────────────────────────────────────────┤    │
│   │                                                     │    │
│   │ Meno *                                              │    │
│   │ [................................................] │    │
│   │                                                     │    │
│   │ Priezvisko *                                        │    │
│   │ [................................................] │    │
│   │                                                     │    │
│   │ Email *                                             │    │
│   │ [................................................] │    │
│   │                                                     │    │
│   │ CIS identifikátor *                                 │    │
│   │ [................................................] │    │
│   │ (i) Musí byť jedinečný v rámci tohto VK            │    │
│   │ (napr. "UC001", "UC002", ...)                      │    │
│   │                                                     │    │
│   │ ┌────────────────────────────────────────────────┐ │    │
│   │ │ Dočasné heslo                                  │ │    │
│   │ ├────────────────────────────────────────────────┤ │    │
│   │ │                                                │ │    │
│   │ │ ○ Generovať automaticky (odporúčané)           │ │    │
│   │ │ ○ Zadať manuálne                               │ │    │
│   │ │                                                │ │    │
│   │ │ [Heslo: (min. 8 znakov)]                       │ │    │
│   │ │                                                │ │    │
│   │ └────────────────────────────────────────────────┘ │    │
│   │                                                     │    │
│   │ Poznámka                                            │    │
│   │ [................................................] │    │
│   │ [................................................] │    │
│   │                                                     │    │
│   │                                                     │    │
│   │                    [Zrušiť]  [Vytvoriť]            │    │
│   │                                                     │    │
│   └────────────────────────────────────────────────────┘    │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## Popis polí a validácie

### 1. Meno *
- **Povinné**
- Max 100 znakov

### 2. Priezvisko *
- **Povinné**
- Max 100 znakov

### 3. Email *
- **Povinné**
- Validácia formátu emailu
- Email nemusí byť jedinečný (viacerí uchádzači môžu mať rovnaký email)

### 4. CIS identifikátor *
- **Povinné**
- **Jedinečný v rámci VK** (nie globálne)
- Alfanumerické znaky (A-Z, 0-9, pomlčka, podčiarkovník)
- Max 50 znakov
- Slúži ako prihlasovacie meno uchádzača

**Validácia:**
```
POST /api/selection-procedures/:spId/candidates/check-cis
{
  "cisIdentifier": "UC001"
}

Response 200:
{
  "available": true
}

Response 409:
{
  "available": false,
  "message": "CIS identifikátor už existuje v tomto VK"
}
```

### 5. Dočasné heslo
Dve možnosti:

**A) Generovať automaticky (odporúčané)**
- Backend vygeneruje náhodné heslo (min. 8 znakov, alfanumerické + špeciálne znaky)
- Heslo sa zobrazí po vytvorení uchádzača (len raz!)

**B) Zadať manuálne**
- Admin/Gestor zadá vlastné heslo
- Min. 8 znakov
- Validácia: aspoň 1 veľké písmeno, 1 malé písmeno, 1 číslo

### 6. Poznámka
- Voliteľné
- Max 500 znakov
- Interná poznámka pre admin/gestor

---

## Proces vytvorenia

### 1. Vyplnenie formulára
- Admin/Gestor vyplní všetky povinné polia
- Vyberie automatické alebo manuálne heslo

### 2. Klik na "Vytvoriť"

**API Request:**
```
POST /api/selection-procedures/:spId/candidates
{
  "firstName": "Peter",
  "lastName": "Novák",
  "email": "peter.novak@example.com",
  "cisIdentifier": "UC001",
  "password": "AutoGenerated123!", // null ak automatické
  "note": "Interná poznámka..."
}
```

**Backend:**
- Validuje všetky polia
- Skontroluje, či CIS identifikátor je jedinečný v rámci VK
- Vygeneruje heslo (ak automatické)
- Hashuje heslo (bcrypt)
- Vytvorí uchádzača s rolou `UCHADZAC`
- Pridá záznam do `CandidateSelectionProcedure` (spája uchádzača s VK)

**Response 201:**
```json
{
  "id": "cand_123",
  "firstName": "Peter",
  "lastName": "Novák",
  "email": "peter.novak@example.com",
  "cisIdentifier": "UC001",
  "temporaryPassword": "XyZ9#mK2pQ", // zobrazí sa len raz!
  "selectionProcedureId": "sp_789",
  "selectionProcedureCode": "VK-2025-001",
  "createdAt": "2025-03-15T14:23:00Z"
}
```

---

## Success Modal - Uchádzač vytvorený

```
┌─────────────────────────────────────────────────────────────┐
│                                                               │
│   ┌────────────────────────────────────────────────────┐    │
│   │ ✓ Uchádzač úspešne vytvorený                       │    │
│   ├────────────────────────────────────────────────────┤    │
│   │                                                     │    │
│   │ Prihlasovacie údaje pre Peter Novák:               │    │
│   │                                                     │    │
│   │ ┌────────────────────────────────────────────────┐ │    │
│   │ │ VK kód: VK-2025-001                            │ │    │
│   │ │ CIS identifikátor: UC001                       │ │    │
│   │ │ Heslo: XyZ9#mK2pQ                              │ │    │
│   │ └────────────────────────────────────────────────┘ │    │
│   │                                                     │    │
│   │ ⚠️ Heslo sa zobrazí len raz!                       │    │
│   │    Odošlite ho uchádzačovi na email:               │    │
│   │    peter.novak@example.com                         │    │
│   │                                                     │    │
│   │ [Kopírovať údaje]  [Odoslať email]  [Zavrieť]      │    │
│   │                                                     │    │
│   └────────────────────────────────────────────────────┘    │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## Akcie po vytvorení

### A) Kopírovať údaje
- Skopíruje do clipboard:
  ```
  VK: VK-2025-001
  CIS identifikátor: UC001
  Heslo: XyZ9#mK2pQ
  ```

### B) Odoslať email
- Pošle email uchádzačovi s prihlasovacími údajmi

**Email template:**
```
Predmet: Prihlasovacie údaje - VK-2025-001

Dobrý deň,

boli Vám vytvorené prihlasovacie údaje do systému VK Smart pre výberové konanie VK-2025-001.

Prihlasovacie údaje:
- VK kód: VK-2025-001
- CIS identifikátor: UC001
- Heslo: XyZ9#mK2pQ

Prihláste sa na adrese: https://vk-smart.gov.sk/login

S pozdravom,
VK Smart tím
```

**API:**
```
POST /api/candidates/:id/send-credentials-email
```

### C) Zavrieť
- Zatvorí modal
- Refresh detailu VK (pridaný uchádzač sa zobrazí v zozname)

---

## Error states

### 1. CIS identifikátor už existuje v VK
```
⚠️ CIS identifikátor "UC001" už existuje v tomto VK.
   Použite iný identifikátor.
```

### 2. Neplatný formát emailu
```
⚠️ Neplatný formát emailu
```

### 3. Slabé heslo (pri manuálnom zadaní)
```
⚠️ Heslo musí obsahovať aspoň 8 znakov, 1 veľké písmeno,
   1 malé písmeno a 1 číslo
```

### 4. Chýbajúce povinné polia
```
⚠️ Vyplňte všetky povinné polia
```

---

## Permissions

### Admin
- ✅ Môže vytvoriť uchádzača len pre VK vo svojich rezortoch

### Gestor, Komisia
- ✅ Môže vytvoriť uchádzača len pre VK, kde je priradený

### Superadmin
- ✅ Môže vytvoriť uchádzača pre ľubovoľné VK

---

## OTÁZKY (na neskôr):

1. **Automatické odoslanie emailu po vytvorení uchádzača?**
   - Má sa email odoslať automaticky? Alebo len manuálne?

2. **Uchádzač môže mať viacero VK?**
   - Môže ten istý email byť použitý pre viacero VK?
   - Alebo každý uchádzač = 1 VK?

3. **História vytvorených uchádzačov**
   - Trackujeme, kto vytvoril uchádzača a kedy?

4. **Bulk vytvorenie uchádzačov**
   - Bude možné vytvoriť viacero uchádzačov naraz? (CSV import?)
   - Alebo len individuálne?
